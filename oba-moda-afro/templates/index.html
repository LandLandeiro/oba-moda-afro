{% extends 'base.html' %}

{% block content %}

{% if banners %}
<div id="heroCarousel" class="carousel slide hero-carousel-fixed-height" data-bs-ride="carousel">
    <div class="carousel-indicators">
        {% for banner in banners %}
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="{{ loop.index0 }}" 
                class="{{ 'active' if loop.first else '' }}" 
                aria-current="{{ 'true' if loop.first else 'false' }}" 
                aria-label="Slide {{ loop.index }}"></button>
        {% endfor %}
    </div>
    <div class="carousel-inner">
        {% for banner in banners %}
        <div class="carousel-item {{ 'active' if loop.first else '' }}">
            
            {% set image_url = url_for('static', filename='uploads/' + (banner.image_url_mobile if banner.image_url_mobile else banner.image_url_desktop)) %}
            {% set image_url_desktop = url_for('static', filename='uploads/' + banner.image_url_desktop) %}
            
            <a href="{{ banner.final_link_url }}">
                
                <picture>
                    {% if banner.image_url_mobile %}
                    <source media="(max-width: 767px)" srcset="{{ image_url }}">
                    {% endif %}
                    <img src="{{ image_url_desktop }}" class="d-block w-100 h-100 object-fit-cover" alt="{{ banner.title }}">
                </picture>

                {% if banner.title %}
                <div class="carousel-caption d-none d-md-block">
                    <h5>{{ banner.title }}</h5>
                    <p>{{ banner.subtitle or '' }}</p>
                </div>
                {% endif %}
            </a>
        </div>
        {% endfor %}
    </div>
    
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Próximo</span>
    </button>
</div>
{% endif %}
<div class="container py-5">

    {% if circular_categories_1 %}
    <div class="row text-center justify-content-center g-4 mb-5">
        <h2 class="section-title">Categorias</h2>
        {% for circ_cat in circular_categories_1 %}
        <div class="col-6 col-md-3 col-lg-2">
            <a href="{{ url_for('categoria_produtos', slug=circ_cat.category.slug) if circ_cat.category else '#' }}" 
               class="text-decoration-none text-dark circular-category-item">
                <img src="{{ url_for('static', filename='uploads/' + circ_cat.image_url) }}" 
                     alt="{{ circ_cat.name }}" 
                     class="img-fluid rounded-circle mb-2 circular-category-image">
                <h6 class="fw-bold">{{ circ_cat.name }}</h6>
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% for section in product_sections %}
    <div class="product-section mb-5">
        <h2 class="section-title text-center mb-4">{{ section.title }}</h2>
        
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
            {% for produto in section.products %}
            <div class="col">
                <div class="card product-card h-100 border-0">
                    <a href="{{ url_for('produto_detalhe', slug=produto.slug) }}">
                        {% if produto.image %}
                        <img src="{{ url_for('static', filename='uploads/' + produto.image) }}" class="card-img-top product-image-fixed-height" alt="{{ produto.name }}">
                        {% else %}
                        <img src="https://via.placeholder.com/300x300?text=Sem+Imagem" class="card-img-top product-image-fixed-height" alt="{{ produto.name }}">
                        {% endif %}
                    </a>
                    <div class="card-body text-center">
                        <h5 class="card-title fs-6">
                            <a href="{{ url_for('produto_detalhe', slug=produto.slug) }}" class="text-decoration-none text-dark">{{ produto.name }}</a>
                        </h5>
                        
                        {% if produto.is_on_sale %}
                            <span class="card-text text-muted text-decoration-line-through small">
                                R$ {{ "%.2f"|format(produto.price)|replace('.', ',') }}
                            </span>
                            <span class="card-text fw-bold text-danger d-block">
                                R$ {{ "%.2f"|format(produto.current_price)|replace('.', ',') }}
                            </span>
                        {% else %}
                            <p class="card-text fw-bold">
                                R$ {{ "%.2f"|format(produto.current_price)|replace('.', ',') }}
                            </p>
                        {% endif %}
                        
                        {% if produto.total_stock > 0 %}
                            <a href="{{ url_for('produto_detalhe', slug=produto.slug) }}" class="btn btn-primary btn-sm">
                                Ver Opções
                            </a>
                        {% else %}
                            <p class="text-muted small">Produto indisponível</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    {% if circular_categories_2 %}
    <div class="row text-center justify-content-center g-4 my-5">
        <h2 class="section-title">Mais Opções</h2>
        {% for circ_cat in circular_categories_2 %}
        <div class="col-6 col-md-3 col-lg-2">
            <a href="{{ url_for('categoria_produtos', slug=circ_cat.category.slug) if circ_cat.category else '#' }}" 
               class="text-decoration-none text-dark circular-category-item">
                <img src="{{ url_for('static', filename='uploads/' + circ_cat.image_url) }}" 
                     alt="{{ circ_cat.name }}" 
                     class="img-fluid rounded-circle mb-2 circular-category-image">
                <h6 class="fw-bold">{{ circ_cat.name }}</h6>
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% if about_section %}
    <div class="row justify-content-center my-5">
        <div class="col-lg-8 text-center">
            <h2 class="section-title">{{ about_section.title }}</h2>
            <div class="lead">
                {{ about_section.content | safe }}
            </div>
        </div>
    </div>
    {% endif %}
    </div>
{% endblock %}
